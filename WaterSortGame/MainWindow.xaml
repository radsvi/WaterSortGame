<Window x:Class="WaterSortGame.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WaterSortGame"
        xmlns:viewTube="clr-namespace:WaterSortGame.Views"
        xmlns:VM="clr-namespace:WaterSortGame.ViewModels"
        xmlns:Models="clr-namespace:WaterSortGame.Models"
        mc:Ignorable="d"
        Title="MainWindow"
        
        Height="690" MinHeight="300" d:MinHeight="150" d:Height="300"
        Width="700" MinWidth="700"
        
        >
    <!--d:DataContext="{d:DesignInstance Type=local:MainWindow}"-->
    <Window.Resources>
        <!--<Models:LiquidsManager x:Key="LiquidsManager"/>-->
        <Models:TubesList x:Key="TubesList"/>
        <VM:MainWindowVM x:Key="MainWindowVM"/>
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding Key="Esc" Command="{Binding EscKeyCommand}"/>
    </Window.InputBindings>

    <Grid DataContext="{Binding Source={StaticResource MainWindowVM}}" Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="25"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Add Extra Vial" Command="{Binding AddExtraTubeCommand}" Width="100" Margin="7,0,0,0"/>
            <Button Content="Restart level" Command="{Binding RestartCommand}" Width="100" HorizontalAlignment="Right" Margin="7,0,0,0"/>
            <Button Content="Options" Command="{Binding OpenOptionsWindowCommand}" Width="100" HorizontalAlignment="Right" Margin="7,0,0,0"/>
        </StackPanel>
        

        <ScrollViewer VerticalScrollBarVisibility="Auto" Grid.Row="1">
            <WrapPanel>
                <!--<StackPanel>
            <Label Content="{Binding MyProperty}"/>
            <Button Content="reset command" Command="{Binding ResetTubesCommand}" />
        </StackPanel>-->
                <ItemsControl
            Name="ListTubes"
            HorizontalContentAlignment="Stretch"
            ItemsSource="{Binding Tubes}"
            d:ItemsSource="{d:SampleData ItemCount=4}"
            >
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="8"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <!--<ListBoxItem/>
            <ListBoxItem/>
            <ListBoxItem/>-->
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <!--https://stackoverflow.com/questions/32064308/pass-command-parameter-to-method-in-viewmodel-in-wpf-->
                                <Button x:Name="btTubeNumber"
                                CommandParameter="{Binding .}"
                                
                                Command="{Binding Path=DataContext.SelectTubeCommand, ElementName=ListTubes}"
                                Margin="{Binding Margin}"
                                >
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Grid>
                                                <Rectangle Margin="10" MinWidth="60" Width="60" Height="242">
                                                    <Rectangle.Fill>
                                                        <VisualBrush>
                                                            <VisualBrush.Visual>
                                                                <Border CornerRadius="0,0,20,20" Background="LightBlue" Width="40" Height="150" />
                                                            </VisualBrush.Visual>
                                                        </VisualBrush>
                                                    </Rectangle.Fill>
                                                </Rectangle>
                                                <Grid Margin="0,15" Height="232">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="20"/>
                                                        <RowDefinition/>
                                                        <RowDefinition/>
                                                        <RowDefinition/>
                                                        <RowDefinition/>
                                                    </Grid.RowDefinitions>
                                                    <Rectangle d:Fill="#145DEF" Fill="{Binding Path=Layers[3].Rgb}" Margin="15,0" Grid.Row="1"/>
                                                    <Rectangle d:Fill="#3F4482" Fill="{Binding Path=Layers[2].Rgb}" Margin="15,0" Grid.Row="2"/>
                                                    <Rectangle d:Fill="#88AAFF" Fill="{Binding Path=Layers[1].Rgb}" Margin="15,0" Grid.Row="3"/>

                                                    <Rectangle Grid.Row="4" Margin="15,0" Width="50">
                                                        <Rectangle.Fill>
                                                            <VisualBrush>
                                                                <VisualBrush.Visual>
                                                                    <Border CornerRadius="0,0,20,20" d:Background="#F27914" Width="40" Height="40"
                                                                    Background="{Binding Path=Layers[0].Rgb}" />
                                                                </VisualBrush.Visual>
                                                            </VisualBrush>
                                                        </Rectangle.Fill>
                                                    </Rectangle>
                                                </Grid>
                                            </Grid>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>



                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </WrapPanel>
        </ScrollViewer>
    </Grid>
</Window>
